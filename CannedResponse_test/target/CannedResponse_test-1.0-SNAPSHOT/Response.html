<html>

<head>
    <title>
        Canned Response Application
    </title>
    <style>
        footer {
            background-color: #777;
            padding: 5px;
            text-align: center;
            color: white;
        }

        body {
            font-family: 'Nunito Sans', sans-serif;
            font-weight: 400;
            line-height: 1.6;
            color: #655A56;
            background-image: linear-gradient(to right bottom, #FBDB89, #F48982);
            background-size: cover;
            background-repeat: no-repeat;
            min-height: calc(100vh - 2 * 4vw);
        }

        .customtable {
            width: 80%;
            margin: 0px auto;
            margin-top: 30px;
        }

        .customtable>caption {
            font-size: 20px;
        }

        .customtable>thead>tr {
            text-align: center;
            font-size: 14px;
        }

        .customtable>thead>tr>th {
            background-color: #9999FF;
            color: white;
            text-align: center;
            vertical-align: middle;
        }

        .customtable>tbody {
            font-size: 14px;
            overflow: auto;
            height: 300px;
        }

        table {
            border-collapse: collapse;
        }

        table,
        th,
        td {
            border: 1px solid black;

        }

        .textArea {
            box-sizing: border-box;
            border: 2px solid #ccc;
            border-radius: 4px;
            background-color: #f8f8f8;
            resize: none;
        }
    </style>

    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.2/css/bootstrap.min.css" integrity="sha384-Smlep5jCw/wG7hdkwQ/Z5nLIefveQRIY9nfy6xoR1uRYBtpZgI6339F5dgvm/e9B"
        crossorigin="anonymous">



</head>

<body>

    <div class="container-fluid">
        <header style="text-align:center">
            <h1>Canned Response Application</h1>
        </header>
    </div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Home</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
            aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item ">
                    <a class="nav-link" href="#AddResponse" id="create1">Add Canned Response
                        <span class="sr-only">(current)</span>
                    </a>
                </li>

                <li class="nav-item">
                    <a class="nav-link " href="#RetrieveResponse" id="retrieve1">Search For Response</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link " href="#DeleteResponse" id="delete1">Delete Response</a>
                </li>
            </ul>

        </div>

    </nav>

    <div class="container">

        <div class="row">
            <div class="col-md-3"></div>
            <div class="col-md-6 form_style">

                <!-- form To Add Response -->
                <form style="display: none;" id="create_form1" name="create_form">
                    <div class="form-group">
                        <label>
                            Title:*
                        </label>
                        <input required class="form-control" type="text" name="title" id="form_title" placeholder="Title">
                    </div>
                    <div class="form-group">
                        <label>
                            Message:*
                        </label>
                        <textarea class="textArea" rows="4" cols="50" name='Message' id='form_message' required>
                            </textarea>
                    </div>
                    <div class="form-group">
                        <label>

                            Add Label :
                        </label>

                        <select required class="custom-select" id="form_addlabel" name="things" placeholder="Choose...">

                        </select>
                    </div>

                    <div id="add" style="display: none">
                        <label>Other Label</label>
                        <input class="form-control" type="text" name="otherlabel" id="otherlabel" placeholder="Enter Label" />
                    </div>
                    <br>

                    <div>
                        <input type="checkbox" id="markPublic" name="mpublic" value="YES" checked>
                        <label for="markPublic">Mark as Public</label>
                    </div>



                    <br>
                    <br>

                    <button type="button" class="btn btn-primary" id="cancel1">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>


                </form>



                <!--Form for Retrieveing Responses  -->


                <form style="display: none;" id="retrieve_form1">

                    <div class="form-group">
                        <label>
                            Search With Related Label :
                        </label>


                        <select required class="custom-select" id="form_retrievelabel">
                            <option selected>Choose...</option>

                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary">Submit</button>
                    <button type="button" class="btn btn-primary" id="cancel2">Cancel</button>
                    <br>
                    <br>
                    <br>
                    <br>
                    <div id="ttable" style="display: none">
                        <input id="myInput" type="text" placeholder="Search..">
                        <br>
                        <br>
                        <h5 style="text-align: center"> ------Related Responses -----</h5>
                    </div>

                    <div id="dtable" style="display: none">

                        <table class="table table-hover" style="margin-top:10px; margin-left:2px;" id="response_table" class="customtable">

                            <thead>
                                <tr>
                                    <th>Select</th>
                                    <!-- <th>Response Id</th> -->
                                    <th>Title</th>
                                    <th>Message</th>
                                    <th>Label</th>
                                    <th>Mark Public</th>
                                    <th>Last Updated Date</th>
                                </tr>
                            </thead>
                            <tbody id="myTable">
                            </tbody>
                        </table>
                        <button type="button" id="deletebtn" style="margin: left">DELETE</button>
                    </div>
                </form>


                <!-- Form To Delete Response(s)(By Response ID)-->

                <form style="display: none;" id="delete_form1">
                    <div class="form-group">
                        <label>
                            User:
                        </label>
                        <input required class="form-control" id="user_id" placeholder="Admin UserName">
                    </div>

                    <div class="form-group">
                        <label>
                            Password:
                        </label>
                        <input required class="form-control" type="password" id="pwd" placeholder="Enter Password">
                    </div>

                    <div class="form-group">
                        <label>
                            Response ID :
                        </label>
                        <input required class="form-control" type="number" id="res_id" placeholder="Enter Response ID">
                    </div>



                    <button type="submit" class="btn btn-primary">Submit</button>
                    <button type="button" class="btn btn-primary" id="cancel3">Cancel</button>

                </form>

            </div>
            <div class="col-md-3"></div>
        </div>

    </div>

    <div class="fixed-bottom">
        <footer>
            <h1 style="text-align: center">---------------</h1>
        </footer>
    </div>


    <script>
        window.scrollbars.visible;
    </script>

    <!-- When User Wants to enter there own Label(By Selecting the 'Other' Option in Select Box)-->

    <script>
        $(document).ready(function () {
            $('select[name=things]').change(function () {
                if ($(this).val() == "") {
                    $("#add").show();
                }
            });
        });
    </script>

    <!--Table Filter In Retrieve Response-->

    <script>
        $(document).ready(function () {
            $("#myInput").on("keyup", function () {
                var value = $(this).val().toLowerCase();
                $("#myTable tr").filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                });
            });
        });
    </script>

    <!-- By Click On CreatResponse -> Updating the Select Box List From DataBase (Dynamicaliy Adding Options To Select Box) -->

    <script>    

        //Navbar Create Response

        $("#create1").click(function () {
            $("#create_form1").css("display", "block");
            $("#retrieve_form1").css("display", "none");
            $("#delete_form1").css("display", "none");

            //Sending action as a Parameter to Controller
            const obj1 = {
                "action": "getLables"
            }

            $.ajax({
                type: "POST",
                url: `http://localhost:8080/CannedResponse_test-1.0-SNAPSHOT/servlets`,
                data: obj1,
                success: successMsg,
                error: function () {
                    alert("Options Retrieved Failed");
                }
            });

            //To Get the List of Lables Data

            function successMsg(data, status, response) {

                var LabelArray = data.substr(1, (data.length - 2));
                var strarr = LabelArray.split(",");
                for (var i = 0; i < strarr.length; i++) {
                    $('#form_addlabel')
                        .append($('<option>', { value: strarr[i].trim() })
                            .text(strarr[i].trim()));
                }
                $('#form_addlabel')
                    .append($('<option value=""><button id = "otherValue">Other</button></option>'));
            }
            $('#form_addlabel').children().remove();
        });


        $("#cancel1").click(function () {
            $("#create_form1").css("display", "none");

        });

        //Navbar Retrieve Responses
        $("#retrieve1").click(function () {
            $("#create_form1").css("display", "none");
            $("#retrieve_form1").css("display", "block");
            $("#delete_form1").css("display", "none");

            const obj1 = {
                "action": "getLables"
            }

            $.ajax({
                type: "POST",
                url: `http://localhost:8080/CannedResponse_test-1.0-SNAPSHOT/servlets`,
                data: obj1,
                success: successMsg,
                error: function () {
                    alert("Options are Failed to Retrieve");
                }
            });
            function successMsg(data, status, response) {
                var labelsArr = data.substr(1, (data.length - 2));
                var strarr = labelsArr.split(",");
                for (var i = 0; i < strarr.length; i++) {
                    $('#form_retrievelabel')
                        .append($('<option>', { value: strarr[i].trim() })
                            .text(strarr[i].trim()));
                }

            }

            $('#form_retrievelabel').children().remove();

        });

        $("#cancel2").click(function () {
            $("#retrieve_form1").css("display", "none");

        });

        //Navbar Delete Responses
        $("#delete1").click(function () {
            $("#create_form1").css("display", "none");
            $("#retrieve_form1").css("display", "none");
            $("#delete_form1").css("display", "block");
        });

        $("#cancel3").click(function () {
            $("#delete_form1").css("display", "none");

        });
    </script>


    <script>


        $('#create_form1').submit(function (event) {
            event.preventDefault();

            $("#add").hide();

            var utitle, umessage, ulabel, umarkpublic, vlable;

            $("input[type='checkbox']").on('click', function () {
                $(this).val(this.checked ? "YES" : "NO");
            })

            vlable = document.getElementById("form_addlabel").value;

            if (vlable == "") {
                vlable = document.getElementById("otherlabel").value;
                var status;
                //To add Other as Option at the end of the Select Box in Create Response Form
                $("#form_addlabel > option").each(function () {
                    status = (this.value == vlable);
                    if (status == true) {
                        return false;
                    }
                    else
                        status = false;
                });
                if (status != true) {

                    var length1 = $('#form_addlabel').children('option').length;
                    $("#form_addlabel option").eq(length1 - 1).before($("<option></option>").val(vlable).text(vlable));

                }
            }

            document.getElementById("form_message").required = true;
            const dataObj = {
                "utitle": document.getElementById("form_title").value,
                "umessage": document.getElementById("form_message").value,
                "ulabel": vlable,
                "umarkpublic": document.getElementById("markPublic").value,
                "action": ""
            }

            //ajax call to create
            $.ajax({
                type: "POST",
                url: `http://localhost:8080/CannedResponse_test-1.0-SNAPSHOT/servlets`,
                data: dataObj,
                success: successMessage,
                error: errorMessage
            });
            function successMessage(data, status, response) {

                if (data === "Success") {

                    alert("Response Saved Successfully !!!");
                }
                else {
                    alert("The Title You entered is already existed Please try with another Title");
                }
            }
            function errorMessage(request, status, error) {
                alert("Oops!! Response is Failed to Save ,Please Try Again");
                //console.log("request: " + request + "status: " + status + "error " + error);
            }
            $("#create_form1")[0].reset();

        });

       

        //Retrieve Form -- To Retrieve Responses -- Ajax call
        $('#retrieve_form1').on('submit', function () {

            event.preventDefault();
            $("#ttable").css("display", "block");
            $("#dtable").css("display", "block");
            getResponses();
            function getResponses() {

                const v1 = document.getElementById("form_retrievelabel").value;
                $.ajax({
                    url: `http://localhost:8080/CannedResponse_test-1.0-SNAPSHOT/servlets?ulabel=${v1}`,
                    type: 'GET',
                    dataType: 'json',
                    success: fillResponse,
                    error: fillResponsesError
                });
                
            }
            function fillResponse(data, status, response) {
                $("#myTable").empty();
                var level1obj = data;
                var table = document.getElementById("response_table");
                var tableRef = table.getElementsByTagName('tbody')[0];

                $(data).each(function (index, value) {
                    var check = "<td><input type='checkbox' value='" + value.response_id + "' name='deleteCheckBox'/></td>";
                    var row = tableRef.insertRow(tableRef.rows.length);
                    var cell1 = row.insertCell(0);
                    var cell2 = row.insertCell(1);
                    var cell3 = row.insertCell(2);
                    var cell4 = row.insertCell(3);
                    var cell5 = row.insertCell(4);
                    var cell6 = row.insertCell(5);
                    var cell7 = row.insertCell(6);


                    console.log("cell insertion dione");
                    cell1.innerHTML = check;
                    cell2.innerHTML = value.response_id;
                    cell3.innerHTML = value.title;
                    cell4.innerHTML = value.message;
                    cell5.innerHTML = value.label;
                    cell6.innerHTML = value.mark_public;
                    var up_date = value.update_date.day + "/" + value.update_date.month + "/" + value.update_date.year;
                    cell7.innerHTML = up_date;
                    
                });
                $('#myTable tr>*:nth-child(2)').hide();
                
            }

            function fillResponsesError(request, status, error) {

                   // alert('Oops!! Responses are failed to Load, Please Try again Later');
                    alert(error);
                    console.log(error);

            }

        });

         //CheckBox Deletion-- For Multiple Deletion of rows in Retrieve Response Form

        $('#deletebtn').on('click', function (event) {
            var response_id = [];
            $("input[name='deleteCheckBox']:checked").each(function (i) {
                response_id[i] = $(this).val();
            });

            //For Removing the Checked Rows from UI table
            var checked = jQuery('input:checkbox:checked').map(function () {
                return this.value;
            }).get();
            jQuery('input:checkbox:checked').parents("tr").remove();

            const filterUrl = `http://localhost:8080/CannedResponse_test-1.0-SNAPSHOT/servlets?delete_uId=${response_id}`;

            $.ajax({
                url: filterUrl,
                type: 'DELETE',
                success: deleteRow,
                error: deleteError
            });

            function deleteRow(data) {
                console.log(data);
                if (data === "Success") {
                    alert("Deleted Successfully");
                } else {
                    alert("Please Select the Rows to Delete");
                }
            };

            function deleteError(request, status, error) {

                alert('Oops Failed To Deleted Please Try Again Later');
                //console.log("request: " + request + "status: " + status + "error " + error);
            }

        });

        //Deletion Form -- Ajax Call to delete responses

        $('#delete_form1').submit(function (event) {

            event.preventDefault();
            const user_id = document.getElementById("user_id").value;
            const pass = document.getElementById("pwd").value;
            const response_id = document.getElementById("res_id").value;

            $.ajax({
                type: "DELETE",
                url: `http://localhost:8080/CannedResponse_test-1.0-SNAPSHOT/servlet1?admin=${user_id}&passwd=${pass}&delete_uId=${response_id}`,
                success: validationSuccess,
                error: validationError

            });
            document.getElementById("res_id").value = "";
            function validationSuccess(data, status, response) {
                if (data === "adminloginfailed") {
                    alert("User Name and Password Does Not Matched");
                }
                else if (data === "Success") {
                    alert("Response is Deleted Successfully");
                }

                else {
                    alert("The Response that you are searching for does not Existed!! please enter valid Response ID");
                }
            }
            function validationError(request, status, error) {
                alert("Oops! Failed To Delete Please Try Again Later");
                //console.log("request: " + request + "status: " + status + "error " + error);
            }

        });

    </script>

</body>

</html>